<x-layout>
  <!-- START OF THE SECTION -->
  <section class="relative min-h-screen bg-white" id="mainContent">

    <!-- Desktop/Large screens: warm gradient + subtle pattern background -->
    <div class="hidden sm:block absolute inset-0 z-0">
      <div
        class="absolute inset-0 bg-gradient-to-br from-amber-50 via-orange-50 to-rose-100 animate-[gradientShift_14s_ease-in-out_infinite]">
      </div>
      <div class="absolute inset-0 opacity-40"
        style="background-image: radial-gradient(rgba(251, 191, 36, 0.25) 1px, transparent 1px); background-size: 22px 22px;">
      </div>
      <!-- Paw accents sprinkled like background (non-interactive) -->
      <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
        <i class="ph-fill ph-paw-print absolute text-yellow-400 opacity-30 text-7xl -top-10 left-8"></i>
        <i class="ph-fill ph-paw-print absolute text-orange-400 opacity-25 text-6xl top-6 left-1/4"></i>
        <i class="ph-fill ph-paw-print absolute text-rose-400 opacity-25 text-5xl top-10 right-1/3"></i>
        <i class="ph-fill ph-paw-print absolute text-yellow-400 opacity-20 text-8xl top-1/3 -left-6"></i>
        <i class="ph-fill ph-paw-print absolute text-orange-400 opacity-25 text-7xl top-1/2 left-1/5"></i>
        <i class="ph-fill ph-paw-print absolute text-rose-400 opacity-20 text-6xl top-2/3 left-1/2"></i>
        <i class="ph-fill ph-paw-print absolute text-yellow-400 opacity-25 text-7xl bottom-10 right-16"></i>
        <i class="ph-fill ph-paw-print absolute text-orange-400 opacity-20 text-5xl bottom-24 right-1/4"></i>
        <i class="ph-fill ph-paw-print absolute text-rose-400 opacity-25 text-6xl bottom-8 left-1/3"></i>
        <!-- Extra right-side sprinkles -->
        <i class="ph-fill ph-paw-print absolute text-yellow-400 opacity-25 text-6xl top-4 right-6"></i>
        <i class="ph-fill ph-paw-print absolute text-orange-400 opacity-20 text-5xl top-1/4 right-10"></i>
        <i class="ph-fill ph-paw-print absolute text-rose-400 opacity-25 text-7xl top-1/3 right-1/6"></i>
        <i class="ph-fill ph-paw-print absolute text-yellow-400 opacity-20 text-6xl top-1/2 right-3"></i>
        <i class="ph-fill ph-paw-print absolute text-orange-400 opacity-25 text-7xl bottom-1/3 right-8"></i>
        <i class="ph-fill ph-paw-print absolute text-rose-400 opacity-20 text-5xl bottom-1/5 right-1/12"></i>
        <i class="ph-fill ph-paw-print absolute text-yellow-400 opacity-25 text-6xl bottom-6 right-4"></i>
      </div>
    </div>
    <div class="relative z-10 max-w-screen-xl mx-auto px-4 md:px-8">
      @if($isPetArchived)
      <div class="mb-6 p-4 bg-gray-100 border-l-4 border-gray-400 rounded-r-lg">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <i class="ph-fill ph-warning text-gray-600 text-xl"></i>
          </div>
          <div class="ml-3">
            <p class="text-sm text-gray-800">
              <span class="font-semibold">This pet has been archived and is no longer available for adoption.</span>
              In the meantime, please browse other available pets for adoption.
            </p>
          </div>
        </div>
      </div>
      @endif

      <!-- Pet Header -->
      <div class="flex flex-wrap justify-between items-center gap-3 mt-2 mb-6">
        <h2 class="text-2xl md:text-3xl font-bold text-gray-900">
          {{ strtolower($pet->pet_name) !== 'n/a' ? ucwords($pet->pet_name) : 'Unnamed' }}
        </h2>
        <span class="flex items-center bg-yellow-400 text-black py-1 px-3 rounded-full text-2xl font-bold shadow-sm">
          {!! $pet->species === 'feline' ? '<i class="ph-fill ph-cat mr-1"></i> Cat' : '<i
            class="ph-fill ph-dog mr-1"></i> Dog' !!} #{{ $pet->pet_number }}
        </span>
      </div>

      <!-- Global Alerts under Pet Header -->
      @if (session('success'))
      <div id="global-alert-success"
        class="flex items-center p-4 mb-4 text-green-800 rounded-lg bg-green-50 border-l-4 border-green-400"
        role="alert">
        <svg class="shrink-0 w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
          viewBox="0 0 20 20">
          <path
            d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z" />
        </svg>
        <span class="sr-only">Info</span>
        <div class="ms-3 text-sm font-medium">
          {!! session('success') !!}
        </div>
        <button type="button"
          class="ms-auto -mx-1.5 -my-1.5 bg-green-50 text-green-500 rounded-lg focus:ring-2 focus:ring-green-400 p-1.5 hover:bg-green-200 inline-flex items-center justify-center h-8 w-8"
          onclick="this.parentElement.remove()" aria-label="Close">
          <span class="sr-only">Close</span>
          <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
          </svg>
        </button>
      </div>
      @endif

      @if (session('error_request') || session('submission_error'))
      <div id="global-alert-error"
        class="flex items-center p-4 mb-4 text-red-800 rounded-lg bg-red-50 border-l-4 border-red-400" role="alert">
        <svg class="shrink-0 w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
          viewBox="0 0 20 20">
          <path
            d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z" />
        </svg>
        <span class="sr-only">Info</span>
        <div class="ms-3 text-sm font-medium">
          {{ session('error_request') ?? session('submission_error') }}
        </div>
        <button type="button"
          class="ms-auto -mx-1.5 -my-1.5 bg-red-50 text-red-500 rounded-lg focus:ring-2 focus:ring-red-400 p-1.5 hover:bg-red-200 inline-flex items-center justify-center h-8 w-8"
          onclick="this.parentElement.remove()" aria-label="Close">
          <span class="sr-only">Close</span>
          <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
          </svg>
        </button>
      </div>
      @endif

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start mb-10">
        <!-- LEFT SIDE: Pet Image -->
        <div>
          <!-- Pet Image -->
          <div class="overflow-hidden rounded-lg shadow-md h-fit cursor-pointer"
            onclick="openImageModal('{{ asset('storage/' . ($pet->image_path ?? 'pet-images/catdog.svg')) }}', '{{ strtolower($pet->pet_name) !== 'n/a' ? ucwords($pet->pet_name) : 'Unnamed' }}')">
            <img src="{{ asset('storage/' . ($pet->image_path ?? 'pet-images/catdog.svg')) }}" alt="Pet Image"
              class="w-full h-auto max-h-[500px] object-cover transition-transform duration-500 hover:scale-105 {{ $pet->archived_at ? 'grayscale opacity-60' : '' }}" />
          </div>
        </div>

        <!-- RIGHT SIDE: Adoption Process Card -->
        <div id="adoption-process-card"
          class="relative p-6 bg-gray-50/80 backdrop-blur-lg rounded-lg border border-yellow-500 shadow-md overflow-hidden">
          <!-- Paw Accents -->
          <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
            <i class="ph-fill ph-paw-print absolute text-yellow-400 opacity-20 text-3xl -top-4 left-4"></i>
            <i class="ph-fill ph-paw-print absolute text-orange-400 opacity-15 text-2xl top-8 right-8"></i>
            <i class="ph-fill ph-paw-print absolute text-rose-400 opacity-15 text-3xl bottom-6 left-12"></i>
            <i class="ph-fill ph-paw-print absolute text-yellow-400 opacity-10 text-2xl bottom-2 right-6"></i>
            <i class="ph-fill ph-paw-print absolute text-orange-400 opacity-15 text-xl top-20 left-20"></i>
            <i class="ph-fill ph-paw-print absolute text-rose-400 opacity-10 text-2xl bottom-12 right-12"></i>
          </div>
          <div class="relative z-10">
            <h3 class="font-bold text-lg text-black mb-4">
              <i class="ph-fill ph-paw-print text-orange-500"></i> Adoption Process
            </h3>
          </div>

          <!-- Numbered Steps List -->
          <div class="mt-4 relative z-10 space-y-3 max-h-[500px] overflow-y-auto pr-2">
            <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
              <div class="flex items-start gap-3">
                <div
                  class="flex-shrink-0 w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold">
                  1
                </div>
                <div class="flex-1">
                  <h4 class="font-semibold text-gray-800 mb-1">Submit Application</h4>
                  <p class="text-sm text-gray-600">Complete the adoption form below with accurate information. You can
                    only have one active application at a time.</p>
                </div>
              </div>
            </div>

            <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
              <div class="flex items-start gap-3">
                <div
                  class="flex-shrink-0 w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold">
                  2
                </div>
                <div class="flex-1">
                  <h4 class="font-semibold text-gray-800 mb-1">Confirm Within 24 Hours</h4>
                  <p class="text-sm text-gray-600">You'll receive a confirmation email that <span
                      class="font-medium text-red-600">must be confirmed within 24 hours</span>. Failure to confirm will
                    automatically cancel your application.</p>
                </div>
              </div>
            </div>

            <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
              <div class="flex items-start gap-3">
                <div
                  class="flex-shrink-0 w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold">
                  3
                </div>
                <div class="flex-1">
                  <h4 class="font-semibold text-gray-800 mb-1">Background Review</h4>
                  <p class="text-sm text-gray-600">Our team reviews confirmed applications. <span
                      class="font-medium text-orange-600">Priority is given to Angeles City residents.</span> If
                    multiple applicants are confirmed, we select based on background check and residency.</p>
                </div>
              </div>
            </div>

            <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
              <div class="flex items-start gap-3">
                <div
                  class="flex-shrink-0 w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold">
                  4
                </div>
                <div class="flex-1">
                  <h4 class="font-semibold text-gray-800 mb-1">Schedule Visitation (48 Hours)</h4>
                  <p class="text-sm text-gray-600">If selected, you'll receive a scheduling email. You <span
                      class="font-medium text-red-600">must set a visitation date within 48 hours</span> (available
                    dates are within 7 business days). No response will cancel your application. Other applicants will
                    be notified that a candidate has been selected.</p>
                </div>
              </div>
            </div>

            <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
              <div class="flex items-start gap-3">
                <div
                  class="flex-shrink-0 w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold">
                  5
                </div>
                <div class="flex-1">
                  <h4 class="font-semibold text-gray-800 mb-1">Visit & Verification</h4>
                  <p class="text-sm text-gray-600 mb-2">On your scheduled date, bring:</p>
                  <ul class="text-sm text-gray-600 list-disc list-inside ml-2 space-y-1">
                    <li>Valid government ID (matching the one you submitted)</li>
                    <li>Your transaction number</li>
                  </ul>
                  <p class="text-sm text-gray-600 mt-2">We'll discuss the pet's needs and care requirements. <span
                      class="font-medium text-green-600">Kittens/puppies 3 months or younger can usually go home
                      immediately</span> as they don't require taming yet.</p>
                </div>
              </div>
            </div>

            <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
              <div class="flex items-start gap-3">
                <div
                  class="flex-shrink-0 w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold">
                  6
                </div>
                <div class="flex-1">
                  <h4 class="font-semibold text-gray-800 mb-1">Pickup & Photo</h4>
                  <p class="text-sm text-gray-600">Upon successful pickup, we'll take an official photo of you with your
                    new pet and adoption details. This will be featured on our Facebook page and website. If the pet has
                    health or behavioral issues, you may need to return for follow-up visits.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pet Details Cards Section -->
      <div class="mb-10">
        @if($hasPendingApplication)
        <div class="mb-6 p-4 bg-red-100 border-l-4 border-red-400 rounded-r-lg">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <i class="ph-fill ph-warning text-red-500 text-xl"></i>
            </div>
            <div class="ml-3">
              <p class="text-sm text-yellow-700">
                You currently have an ongoing adoption application.
                <a href="/transactions/adoption-status" class="font-medium underline text-red-700 hover:text-red-600">
                  View your current application</a>.
                Please wait until it's completed or rejected before submitting a new request.
              </p>
            </div>
          </div>
        </div>
        @endif

        @if($applicationLimitReached)
        <div class="mb-6 p-4 bg-yellow-100 border-l-4 border-yellow-400 rounded-r-lg">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <i class="ph-fill ph-warning text-yellow-600 text-xl"></i>
            </div>
            <div class="ml-3">
              <p class="text-sm text-yellow-800">
                <span class="font-semibold">This pet is no longer accepting applications at the moment.</span> In the
                meantime, please browse other available pets for adoption.
              </p>
            </div>
          </div>
        </div>
        @endif

        <div class="flex flex-wrap justify-between items-center mb-4 gap-2">
          <h3 class="text-lg font-semibold text-gray-800 flex items-center">
            <i class="ph-fill ph-paw-print mr-2 text-orange-500"></i>Pet Details
          </h3>
          <div class="flex flex-wrap gap-2">
            @php
            $timeAgo = \Carbon\Carbon::parse($pet->created_at)->diffForHumans();
            $applicantCount = \App\Models\AdoptionApplication::where('pet_id', $pet->id)
            ->whereNotIn('status', ['archived', 'rejected'])
            ->count();
            @endphp
            <span class="bg-black/10 text-gray-700 text-sm px-4 py-2 rounded-full flex items-center">
              <i class="ph-fill ph-clock mr-1.5 text-base"></i> Added {{ $timeAgo }}
            </span>
            <span class="bg-green-100 text-green-700 text-sm px-4 py-2 rounded-full flex items-center font-medium">
              <i class="ph-fill ph-users mr-1.5 text-base"></i> {{ $applicantCount }} {{ $applicantCount === 1 ?
              'Applicant' : 'Applicants' }} on Waiting List
            </span>
          </div>
        </div>

        <!-- Pet Details Grid -->
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          <!-- Species Card -->
          @php
          $speciesIcon = match ($pet->species) {
          'canine' => 'dog',
          'feline' => 'cat',
          default => 'paw-print'
          };
          @endphp
          <div
            class="relative bg-blue-50 text-blue-800 p-4 rounded-xl border border-blue-100 shadow-sm overflow-hidden hover:shadow-md transition-shadow">
            <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
              <i class="ph-fill ph-paw-print absolute text-blue-300 opacity-10 text-3xl -top-2 -right-2"></i>
            </div>
            <div class="relative z-10">
              <p class="text-xs font-medium text-blue-600 flex items-center mb-2">
                <i class="ph-fill ph-{{ $speciesIcon }} mr-1"></i> Species
              </p>
              <p class="font-semibold text-lg">{{ ucfirst($pet->species) }}</p>
            </div>
          </div>

          <!-- Breed Card (if exists) -->
          @if(!empty($pet->breed))
          <div
            class="relative bg-teal-50 text-teal-800 p-4 rounded-xl border border-teal-100 shadow-sm overflow-hidden hover:shadow-md transition-shadow">
            <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
              <i class="ph-fill ph-paw-print absolute text-teal-300 opacity-10 text-3xl -top-2 -right-2"></i>
            </div>
            <div class="relative z-10">
              <p class="text-xs font-medium text-teal-600 flex items-center mb-2">
                <i class="ph-fill ph-paw-print mr-1"></i> Breed
              </p>
              <p class="font-semibold text-lg">{{ ucfirst($pet->breed) }}</p>
            </div>
          </div>
          @endif

          <!-- Age Card -->
          <div
            class="relative bg-purple-50 text-purple-800 p-4 rounded-xl border border-purple-100 shadow-sm overflow-hidden hover:shadow-md transition-shadow">
            <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
              <i class="ph-fill ph-paw-print absolute text-purple-300 opacity-10 text-3xl -top-2 -right-2"></i>
            </div>
            <div class="relative z-10">
              <p class="text-xs font-medium text-purple-600 flex items-center mb-2">
                <i class="ph-fill ph-cake mr-1"></i> Age
              </p>
              <p class="font-semibold text-lg">
                {{ $pet->formatted_age }} {{ $pet->formatted_age == 1 ? Str::singular($pet->age_unit) :
                Str::plural($pet->age_unit) }}
              </p>
            </div>
          </div>

          <!-- Sex Card -->
          <div
            class="relative {{ $pet->sex == 'male' ? 'bg-blue-50 text-blue-800 border-blue-100' : 'bg-pink-50 text-pink-800 border-pink-100' }} p-4 rounded-xl border shadow-sm overflow-hidden hover:shadow-md transition-shadow">
            <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
              <i
                class="ph-fill ph-paw-print absolute {{ $pet->sex == 'male' ? 'text-blue-300' : 'text-pink-300' }} opacity-10 text-3xl -top-2 -right-2"></i>
            </div>
            <div class="relative z-10">
              <p
                class="text-xs font-medium {{ $pet->sex == 'male' ? 'text-blue-600' : 'text-pink-600' }} flex items-center mb-2">
                <i class="ph-fill ph-{{ $pet->sex == 'male' ? 'gender-male' : 'gender-female' }} mr-1"></i> Sex
              </p>
              <p class="font-semibold text-lg">{{ ucfirst($pet->sex) }}</p>
            </div>
          </div>

          <!-- Reproductive Status Card -->
          @php
          $isNeutered = $pet->reproductive_status === 'neutered';
          $isIntact = $pet->reproductive_status === 'intact';
          $isCanine = $pet->species === 'canine';
          $isFeline = $pet->species === 'feline';

          $bgClass = $isNeutered ? 'bg-green-50 text-green-800 border-green-100' : 'bg-amber-50 text-amber-800
          border-amber-100';
          $textColor = $isNeutered ? 'text-green-600' : 'text-amber-600';
          $accentColor = $isNeutered ? 'text-green-300' : 'text-amber-300';
          $icon = match (true) {
          $isNeutered => 'scissors',
          $isIntact && $isCanine => 'dog',
          $isIntact && $isFeline => 'cat',
          default => 'question'
          };
          @endphp
          <div
            class="relative {{ $bgClass }} p-4 rounded-xl border shadow-sm overflow-hidden hover:shadow-md transition-shadow">
            <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
              <i class="ph-fill ph-paw-print absolute {{ $accentColor }} opacity-10 text-3xl -top-2 -right-2"></i>
            </div>
            <div class="relative z-10">
              <p class="text-xs font-medium {{ $textColor }} flex items-center mb-2">
                <i class="ph-fill ph-{{ $icon }} mr-1"></i> Reproductive
              </p>
              <p class="font-semibold text-lg">{{ ucfirst($pet->reproductive_status) }}</p>
            </div>
          </div>

          <!-- Color Card -->
          <div
            class="relative bg-indigo-50 text-indigo-800 p-4 rounded-xl border border-indigo-100 shadow-sm overflow-hidden hover:shadow-md transition-shadow">
            <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
              <i class="ph-fill ph-paw-print absolute text-indigo-300 opacity-10 text-3xl -top-2 -right-2"></i>
            </div>
            <div class="relative z-10">
              <p class="text-xs font-medium text-indigo-600 flex items-center mb-2">
                <i class="ph-fill ph-palette mr-1"></i> Color
              </p>
              <p class="font-semibold text-lg">{{ ucfirst($pet->color) }}</p>
            </div>
          </div>

          <!-- Source Card -->
          <div
            class="relative bg-gray-50 text-gray-800 p-4 rounded-xl border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow">
            <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
              <i class="ph-fill ph-paw-print absolute text-gray-300 opacity-10 text-3xl -top-2 -right-2"></i>
            </div>
            <div class="relative z-10">
              <p class="text-xs font-medium text-gray-600 flex items-center mb-2">
                <i class="ph-fill ph-buildings mr-1"></i> Source
              </p>
              <p class="font-semibold text-lg">{{ ucfirst($pet->source) }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom: Adoption Form (Wizard) -->
      <div class="relative p-6 rounded-xl bg-gray-50 border border-gray-300 shadow-md overflow-hidden">
        <!-- Paw Accents -->
        <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
          <i class="ph-fill ph-paw-print absolute text-yellow-400 opacity-15 text-4xl -top-6 left-8"></i>
          <i class="ph-fill ph-paw-print absolute text-orange-400 opacity-10 text-3xl top-10 right-12"></i>
          <i class="ph-fill ph-paw-print absolute text-rose-400 opacity-10 text-4xl bottom-8 left-16"></i>
          <i class="ph-fill ph-paw-print absolute text-yellow-400 opacity-15 text-3xl bottom-4 right-8"></i>
          <i class="ph-fill ph-paw-print absolute text-orange-400 opacity-10 text-2xl top-20 left-24"></i>
          <i class="ph-fill ph-paw-print absolute text-rose-400 opacity-10 text-3xl bottom-16 right-20"></i>
        </div>
        <!-- Alerts -->
        <div class="relative z-10">
          <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center relative z-10">
            <i class="ph-fill ph-clipboard-text mr-2 text-orange-500"></i>Adoption Application Form
          </h3>

          <!-- Stepper -->
          <div class="mb-4">
            <div class="flex items-center justify-between">
              <div class="flex-1 h-2 bg-gray-200 rounded-full mr-3">
                <div id="adoptProgress" class="h-2 bg-orange-500 rounded-full" style="width: 25%"></div>
              </div>
              <span id="adoptStepLabel" class="text-xs text-gray-600">Step 1 of 4</span>
            </div>
            <div class="mt-2 grid grid-cols-4 gap-2 text-[11px] text-gray-600">
              <div class="text-center">Personal</div>
              <div class="text-center">Pet Qs</div>
              <div class="text-center">Documents</div>
              <div class="text-center">Oath & Submit</div>
            </div>
          </div>

          <form method="POST" action="/services/{{ $pet->slug }}/adoption-form" id="applicationForm"
            enctype="multipart/form-data">
            @csrf

            @guest
            <x-login-required-banner />
            @endguest

            <!-- Step 1: Personal Information -->
            <div class="adopt-step" data-step="1">
              <h4 class="text-md font-medium text-gray-700 mb-3 flex items-center">
                <i class="ph-fill ph-user-circle mr-2"></i>Personal Information
              </h4>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">Full Name</label>
                  <input type="text" name="full_name"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-orange-300 focus:border-orange-400"
                    placeholder="Your full name" value="{{ old('full_name') }}" required />
                  <x-form-error name="full_name" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">Email</label>
                  @guest
                  <input type="email" name="email" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm"
                    placeholder="Your email" value="{{ old('email') }}" required />
                  @endguest

                  @auth
                  <input type="email" name="email"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm bg-gray-100"
                    placeholder="Your email" value="{{ auth()->user()->email }}" readonly required />
                  @endauth
                  <x-form-error name="email" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">Birthdate</label>
                  <input type="date" name="birthdate" id="birthdate"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-orange-300 focus:border-orange-400"
                    value="{{ old('birthdate') }}" required max="{{ date('Y-m-d') }}"
                    onchange="calculateAge(this.value)" />
                  <x-form-error name="birthdate" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">Age</label>
                  <input type="number" name="age" id="age"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm bg-gray-100"
                    placeholder="Auto-calculated" value="{{ old('age') }}" readonly required />
                  <x-form-error name="age" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">Contact Number</label>
                  <input type="text" name="contact_number"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-orange-300 focus:border-orange-400"
                    placeholder="Your contact number (e.g., 09123456789)" value="{{ old('contact_number') }}"
                    required />
                  <x-form-error name="contact_number" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">Address</label>
                  <input type="text" name="address"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-orange-300 focus:border-orange-400"
                    placeholder="Your residential address" value="{{ old('address') }}" required />
                  <x-form-error name="address" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">Civil Status</label>
                  <select name="civil_status"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-orange-300 focus:border-orange-400"
                    required>
                    <option value="" disabled {{ old('civil_status') ? '' : 'selected' }}>Select status</option>
                    <option value="Single" {{ old('civil_status')=='Single' ? 'selected' : '' }}>Single</option>
                    <option value="Married" {{ old('civil_status')=='Married' ? 'selected' : '' }}>Married</option>
                    <option value="Divorced" {{ old('civil_status')=='Divorced' ? 'selected' : '' }}>Divorced</option>
                  </select>
                  <x-form-error name="civil_status" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">Citizenship</label>
                  <input type="text" name="citizenship"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-orange-300 focus:border-orange-400"
                    placeholder="Your citizenship" value="{{ old('citizenship') }}" required />
                  <x-form-error name="citizenship" />
                </div>
              </div>
            </div>


            <!-- Step 2: Pet-related Questions -->
            <div class="adopt-step hidden" data-step="2">
              <h4 class="text-md font-medium text-gray-700 mb-3 flex items-center">
                <i class="ph-fill ph-paw-print mr-2"></i>Pet Information
              </h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">Why do you want to adopt?</label>
                  <textarea name="reason_for_adoption"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-orange-300 focus:border-orange-400"
                    rows="8" placeholder="Explain why you want to adopt this pet"
                    required>{{ old('reason_for_adoption') }}</textarea>
                  <x-form-error name="reason_for_adoption" />
                </div>
                <div class="flex flex-col gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Do you visit a Veterinarian?</label>
                    <select name="visit_veterinarian"
                      class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-orange-300 focus:border-orange-400"
                      required>
                      <option value="" disabled {{ old('visit_veterinarian') ? '' : 'selected' }}>Select option</option>
                      <option value="Yes" {{ old('visit_veterinarian')=='Yes' ? 'selected' : '' }}>Yes</option>
                      <option value="No" {{ old('visit_veterinarian')=='No' ? 'selected' : '' }}>No</option>
                      <option value="Sometimes" {{ old('visit_veterinarian')=='Sometimes' ? 'selected' : '' }}>Sometimes
                      </option>
                    </select>
                    <x-form-error name="visit_veterinarian" />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Do you have any pet(s) in your house?
                      How
                      many?</label>
                    <input type="number" name="existing_pets"
                      class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-orange-300 focus:border-orange-400"
                      placeholder="Number of pets you currently have" value="{{ old('existing_pets') }}" required />
                    <x-form-error name="existing_pets" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Step 3: Documents -->
            <div class="adopt-step hidden" data-step="3">
              <h4 class="text-md font-medium text-gray-700 mb-3 flex items-center">
                <i class="ph-fill ph-identification-card mr-2"></i>Documents
              </h4>
              
              <!-- Privacy Notice for Valid ID -->
              <div class="mb-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-r-lg">
                <div class="flex items-start">
                  <div class="flex-shrink-0">
                    <i class="ph-fill ph-shield-check text-blue-600 text-xl"></i>
                  </div>
                  <div class="ml-3">
                    <h5 class="text-sm font-semibold text-blue-800 mb-1">Your Privacy is Protected</h5>
                    <p class="text-xs text-blue-700 leading-relaxed">
                      Your ID is used solely for identity verification and eligibility confirmation. We do not share, sell, or use your ID for any other purpose. All documents are securely stored and handled in accordance with our <a href="/privacy-policy" class="underline font-medium hover:text-blue-900" target="_blank">Privacy Policy</a>.
                    </p>
                  </div>
                </div>
              </div>

              <div>
                <div class="flex justify-between items-center mb-1">
                  <label class="block text-sm font-medium text-gray-600">Upload Image of Valid ID (must be 5MB or below)
                    <span class="text-red-500">*</span></label>
                  <button type="button" onclick="openValidIdModal()"
                    class="text-sm text-orange-600 hover:text-orange-700 font-medium cursor-pointer">View Accepted Valid
                    IDs</button>
                </div>
                <input type="file" name="valid_id"
                  class="w-full border border-gray-300 rounded-lg px-4 py-2 text-sm file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100"
                  accept="image/*" required />
                <x-form-error name="valid_id" />
              </div>
            </div>

            <!-- Step 4: Oath & Submit -->
            <div class="adopt-step hidden" data-step="4">
              <div class="p-4 bg-orange-50 rounded-lg border border-orange-100">
                <h4 class="text-sm font-medium text-orange-800 mb-2 flex items-center">
                  <i class="ph-fill ph-hand-palm mr-2"></i>Oath Declaration
                </h4>
                <div class="text-sm text-gray-700 leading-relaxed">
                  I, <span id="inserted_name" class="font-semibold text-orange-600">[Your Full Name]</span>, do solemnly
                  swear that I will take good care of my adopted pet, and he/she will not stray in the street again. I
                  will take him/her to a veterinarian for regular check-ups and/or vaccination.
                  <br><br>
                  Issued this <span id="oath_day" class="font-semibold text-orange-600">[Day]</span> day of <span
                    id="oath_month" class="font-semibold text-orange-600">[Month]</span>, 20<span id="oath_year"
                    class="font-semibold text-orange-600">[YY]</span>, at the Orpawnage Angeles Main Office - Animal
                  Shelter, Angeles City Pampanga.
                </div>
              </div>

              <!-- Terms and Conditions Agreement -->
              <div class="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
                <div class="flex items-start gap-3">
                  <input type="checkbox" name="terms_agreement" id="terms_agreement"
                    class="mt-1 w-4 h-4 text-orange-500 bg-gray-100 border-gray-300 rounded focus:ring-orange-500 focus:ring-2"
                    required />
                  <label for="terms_agreement" class="text-sm text-gray-700 leading-relaxed">
                    I have read and agree to the <a href="/terms-and-conditions" target="_blank" class="text-orange-600 hover:text-orange-700 font-medium underline">Terms and Conditions</a> and <a href="/privacy-policy" target="_blank" class="text-orange-600 hover:text-orange-700 font-medium underline">Privacy Policy</a> of OrPAWnage. I understand that the information I provide will be used solely for processing my adoption application and verifying my eligibility.
                  </label>
                </div>
                <x-form-error name="terms_agreement" />
              </div>

              <div class="flex justify-end mt-4">
                @auth
                @if($applicationLimitReached)
                <button type="button" disabled
                  class="px-5 mt-2 bg-gray-400 text-white text-sm font-medium rounded-lg py-2 cursor-not-allowed flex items-center justify-center shadow-md">
                  <i class="ph-fill ph-x-circle mr-2"></i>Application Limit Reached
                </button>
                @else
                <button type="submit" id="submitAdoption"
                  class="px-5 mt-2 bg-orange-500 text-white text-sm font-medium rounded-lg py-2 hover:bg-yellow-400 hover:text-black transition duration-300 flex items-center justify-center shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                  <i class="ph-fill ph-paw-print mr-2"></i>Submit Adoption Request
                </button>
                @endif
                @endauth

                @guest
                <button type="button" disabled
                  class="px-5 mt-2 bg-gray-500 text-white text-sm font-medium rounded-lg py-2 hover:bg-yellow-400 hover:text-black transition duration-300 flex items-center justify-center shadow-md hover:shadow-lg">
                  <i class="ph-fill ph-paw-print mr-2"></i>Login to Submit
                </button>
                @endguest
              </div>
            </div>

        </div>

        <!-- Wizard Controls -->
        <div class="mt-4 flex items-center justify-between">
          <button type="button" id="adoptPrev"
            class="px-4 py-2 text-sm rounded-md border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-40"
            disabled>
            Back
          </button>
          <button type="button" id="adoptNext"
            class="px-5 bg-orange-500 text-white text-sm font-medium rounded-lg py-2 hover:bg-yellow-400 hover:text-black transition duration-300 flex items-center justify-center shadow-md hover:shadow-lg">
            Next
          </button>
        </div>

        </form>
      </div>
    </div>

    </div>
  </section>

  <!-- Valid ID Modal -->
  <div id="validIdModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center px-1">
    <div class="bg-white p-6 rounded-lg shadow-lg max-w-md w-full space-y-4 relative max-h-[90vh] overflow-y-auto">
      <!-- Close Button -->
      <button onclick="closeValidIdModal()" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700">
        <i class="ph-fill ph-x text-xl"></i>
      </button>

      <h2 class="text-xl font-semibold">Accepted Valid IDs</h2>

      <div class="text-sm text-gray-600 space-y-4">
        <div>
          <strong class="block mb-2">Primary IDs:</strong>
          <ul class="list-disc list-inside ml-4 space-y-1">
            <li>Philippine Identification (PhilID/ePhilID)</li>
            <li>Passport</li>
            <li>Driver's License</li>
            <li>UMID</li>
            <li>PRC ID</li>
            <li>Voter's ID</li>
          </ul>
        </div>

        <div>
          <strong class="block mb-2">Secondary IDs:</strong>
          <ul class="list-disc list-inside ml-4 space-y-1">
            <li>PhilHealth ID</li>
            <li>Postal ID</li>
            <li>Senior Citizen ID</li>
            <li>PWD ID</li>
            <li>School ID</li>
            <li>TIN</li>
            <li>Company ID</li>
            <li>Baptismal Certificate</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  {{-- FULL IMAGE VIEW MODAL --}}
  <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center p-4">
    <div class="relative w-auto">
      <!-- Full Size Image -->
      <img id="modalImage" src="" alt="Full size pet image"
        class="w-full h-auto max-h-[90vh] object-contain rounded-lg {{ $pet->archived_at ? 'grayscale' : '' }}">

      <!-- Image Caption -->
      <div class="text-center mt-2 text-white">
        <span id="imageCaption" class="text-lg"></span>
      </div>
    </div>
  </div>

  <!-- Minor Age Modal -->
  <div id="minorAgeModal"
    class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center px-1">
    <div class="bg-white p-6 rounded-lg shadow-lg max-w-md w-full space-y-4 relative max-h-[90vh] overflow-y-auto">
      <!-- Close Button -->
      <button onclick="closeMinorAgeModal()" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700">
        <i class="ph-fill ph-x text-xl"></i>
      </button>

      <h2 class="text-xl font-semibold">Assistance Required</h2>

      <div class="text-sm text-gray-600 space-y-2">
        <p>Since you are under 18 years old, you will need assistance from a parent or guardian to proceed with the
          application.</p>
      </div>

      <div class="flex justify-end">
        <button onclick="closeMinorAgeModal()"
          class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-yellow-400 hover:text-black transition">
          OK
        </button>
      </div>
    </div>
  </div>

  <script>
    // Wizard logic for Adoption form
    (function() {
      const steps = Array.from(document.querySelectorAll('.adopt-step'));
      const nextBtn = document.getElementById('adoptNext');
      const prevBtn = document.getElementById('adoptPrev');
      const submitBtn = document.getElementById('submitAdoption');
      const progress = document.getElementById('adoptProgress');
      const label = document.getElementById('adoptStepLabel');
      const termsCheckbox = document.getElementById('terms_agreement');
      const total = steps.length || 4;
      let current = 1;

      function showStep(step) {
        steps.forEach(s => s.classList.add('hidden'));
        const active = steps.find(s => s.getAttribute('data-step') === String(step));
        if (active) active.classList.remove('hidden');

        const pct = Math.max(25, Math.min(100, (step / total) * 100));
        progress.style.width = pct + '%';
        label.textContent = `Step ${step} of ${total}`;

        prevBtn.disabled = step === 1;
        nextBtn.classList.toggle('hidden', step === total);
        
        // Enable/disable submit button based on terms checkbox
        if (step === total && submitBtn && termsCheckbox) {
          submitBtn.disabled = !termsCheckbox.checked;
        }
      }

      function validateStep(step) {
        const container = steps.find(s => s.getAttribute('data-step') === String(step));
        if (!container) return true;
        const requiredInputs = container.querySelectorAll('[required]');
        for (const input of requiredInputs) {
          if (input.type === 'checkbox') {
            if (!input.checked) {
              input.reportValidity();
              return false;
            }
          } else if (input.type === 'file') {
            if (!input.files || input.files.length === 0) {
              input.reportValidity();
              return false;
            }
          } else if (!input.value) {
            input.reportValidity();
            return false;
          }
        }
        return true;
      }

      nextBtn?.addEventListener('click', () => {
        if (!validateStep(current)) return;
        current = Math.min(total, current + 1);
        showStep(current);
      });
      
      prevBtn?.addEventListener('click', () => {
        current = Math.max(1, current - 1);
        showStep(current);
      });

      // Listen to terms checkbox changes
      if (termsCheckbox && submitBtn) {
        termsCheckbox.addEventListener('change', () => {
          submitBtn.disabled = !termsCheckbox.checked;
        });
      }

      showStep(current);
    })();

    function getOrdinal(n) {
      const s = ["th", "st", "nd", "rd"],
            v = n % 100;
      return n + (s[(v - 20) % 10] || s[v] || s[0]);
    }

    // OATH DATA AUTO-FILL, AGE CALCULATION, AND HEADER SPACER
    document.addEventListener('DOMContentLoaded', function () {
      const fullNameInput = document.querySelector('input[name="full_name"]');
      const oathNameSpan = document.getElementById('inserted_name');
      const birthdateInput = document.getElementById('birthdate');

      if (fullNameInput && oathNameSpan) {
        // Initial name update
        if (fullNameInput.value) {
          oathNameSpan.textContent = fullNameInput.value;
        }

        // Name input listener
        fullNameInput.addEventListener('input', () => {
          oathNameSpan.textContent = fullNameInput.value.trim() || '[Your Full Name]';
        });
      }

      // Oath date initialization
      const today = new Date();
      const oathDay = document.getElementById('oath_day');
      const oathMonth = document.getElementById('oath_month');
      const oathYear = document.getElementById('oath_year');
      if (oathDay) oathDay.textContent = getOrdinal(today.getDate());
      if (oathMonth) oathMonth.textContent = today.toLocaleString('default', { month: 'long' });
      if (oathYear) oathYear.textContent = String(today.getFullYear()).slice(-2);

      // Initial age calculation if birthdate has value
      if (birthdateInput && birthdateInput.value) {
        calculateAge(birthdateInput.value);
      }

      // Header spacer function
      const header = document.getElementById('main-header');
      const mainContent = document.getElementById('mainContent');
      const adminIndicator = document.getElementById('adminIndicator');
      const EXTRA_TOP_SPACING_PX = 8;

      function computeHeights() {
        const headerHeight = header ? header.offsetHeight : 0;
        const adminHeight = adminIndicator ? adminIndicator.offsetHeight : 0;
        return { headerHeight, adminHeight };
      }

      function updateHeaderSpacer() {
        if (!mainContent) return;
        const { headerHeight, adminHeight } = computeHeights();
        const totalTop = headerHeight + adminHeight;

        if (adminIndicator) {
          mainContent.style.paddingTop = `${(totalTop + EXTRA_TOP_SPACING_PX) * .8}px`;
          mainContent.style.paddingBottom = `${(totalTop + EXTRA_TOP_SPACING_PX) * .5}px`;
        } else {
          mainContent.style.paddingTop = `${(totalTop + EXTRA_TOP_SPACING_PX)}px`;
          mainContent.style.paddingBottom = `${(totalTop + EXTRA_TOP_SPACING_PX)}px`;
        }
      }

      // Initial spacer update
      updateHeaderSpacer();

      // Spacer update on resize
      window.addEventListener('resize', updateHeaderSpacer);

      // React to header/admin indicator size changes
      if (window.ResizeObserver) {
        const ro = new ResizeObserver(updateHeaderSpacer);
        if (header) ro.observe(header);
        if (adminIndicator) ro.observe(adminIndicator);
      }
    });

    function calculateAge(birthdate) {
      if (!birthdate) return;

      const today = new Date();
      const birthDate = new Date(birthdate);

      // Calculate age
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();

      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }

      // Update age field
      const ageInput = document.getElementById('age');
      if (ageInput) {
        ageInput.value = age;
      }

      if (age < 18) {
        const modal = document.getElementById('minorAgeModal');
        if (modal) {
          modal.classList.remove('hidden');
        }
      }
    }

    function closeMinorAgeModal() {
      const modal = document.getElementById('minorAgeModal');
      if (modal) {
        modal.classList.add('hidden');
      }
    }

    function openImageModal(imageSrc, caption) {
      const modal = document.getElementById('imageModal');
      const modalImage = document.getElementById('modalImage');
      const imageCaption = document.getElementById('imageCaption');

      if (modal && modalImage && imageCaption) {
        modalImage.src = imageSrc;
        imageCaption.textContent = caption;
        modal.classList.remove('hidden');
      }
    }

    function openValidIdModal() {
      const modal = document.getElementById('validIdModal');
      if (modal) {
        modal.classList.remove('hidden');
      }
    }

    function closeValidIdModal() {
      const modal = document.getElementById('validIdModal');
      if (modal) {
        modal.classList.add('hidden');
      }
    }

    // Close modals when clicking outside
    document.addEventListener('click', function(e) {
      const imageModal = document.getElementById('imageModal');
      const validIdModal = document.getElementById('validIdModal');

      if (e.target === imageModal) {
        imageModal.classList.add('hidden');
      }

      if (e.target === validIdModal) {
        validIdModal.classList.add('hidden');
      }
    });
  </script>
</x-layout>
